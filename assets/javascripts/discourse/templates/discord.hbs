{{#if siteSettings.discord_header_image }}
  <img src="{{ siteSettings.discord_header_image }}" alt="header_image">
{{else}}
  <h1>{{d-icon 'fab-discord'}}{{" "}}{{ i18n 'discord_datastore.user_title' }}</h1>
{{/if}}

{{#if is_staff }}
<a class="discord-admin-url" href="/admin/discord">{{ i18n 'discord_datastore.view_admin_url_text' }}{{" âžš"}}</a>
{{/if}}

{{#if discord_id }}

  <div class="discord-data">

    <div class="discord-data-stats">
      <div class="discord-stat">
        {{#if messages_loaded}} <div class="discord-stat-value">{{ stats.total }}</div> {{else}} <div class='spinner'></div> {{/if}}
        <div class="discord-stat-label">{{i18n 'discord_datastore.stat_total_message'}}</div>
      </div>
      
      <div class="discord-stat">
        {{#if messages_loaded}} <div class="discord-stat-value">{{ stats.total_monthly }}</div> {{else}} <div class='spinner'></div> {{/if}}
        <div class="discord-stat-label">{{i18n 'discord_datastore.stat_monthly_message'}}</div>
      </div>
      
      <div class="discord-stat">
        {{#if messages_loaded}} <div class="discord-stat-value">{{ stats.total_weekly }}</div> {{else}} <div class='spinner'></div> {{/if}}
        <div class="discord-stat-label">{{i18n 'discord_datastore.stat_weekly_message'}}</div>
      </div>
      
      <div class="discord-stat">
        {{#if messages_loaded}} <div class="discord-stat-value">{{ stats.first_message }}</div> {{else}} <div class='spinner'></div> {{/if}}
        <div class="discord-stat-label">{{i18n 'discord_datastore.stat_first_message'}}</div>
      </div>
    </div>
    
    <hr> <!-- ==================================================================================== -->
    
    <div class="discord-data-rank-header">
      <h3>{{d-icon 'fab-discord'}}{{" "}}{{ i18n "discord_datastore.rank_title" }}</h3>
    </div>

    <div class="discord-data-rank">
      {{#each ranks as |rank|}}
        
        <div class="discord-rank discord-rank-have-{{ rank.have }}">
          <img class="discord-rank-img" src="{{ rank.image }}" alt="" />
          <div class="discord-rank-label">{{ rank.name }}</div>
          <div class="discord-rank-count">{{ rank.requirement_string }}{{" "}}{{ i18n "discord_datastore.messages" }}</div>

          {{#if rank.badge }}

            {{#if rank.have }}
              <div class="discord-collected-button">{{ i18n "discord_datastore.collected_rank" }}</div>
            {{else}}
              {{#if rank.can_collect }}
                <button {{action "collectRank" rank.badge }} class="discord-collect-button">{{ i18n "discord_datastore.collect_rank" }}</button>
              {{else}}
                <div class="discord-locked-button">{{ i18n "discord_datastore.locked_rank" }}</div>
              {{/if}}
            {{/if}}
          {{/if}}

        </div>
      {{/each}}

    </div>

    <hr> <!-- ==================================================================================== -->

    <div class="discord-data-columns">

      <div class="discord-data-channels">
        <div class="discord-data-channels-header">
          <h3>{{d-icon 'fab-discord'}}{{" "}}{{ i18n "discord_datastore.channel_title" }}</h3>
        </div>

        {{#if channels_loaded}}

          {{#if channels}}
            <div class="discord-channel-list" >
              {{#each channels as |channel|}}
                <div><button {{action "filterChannel" channel.id }} type='submit' class='discord-channel-list-element'>
                  <h3>{{ "#" }}{{ channel.name }}</h3>{{ channel.total }}{{ ' ' }}{{i18n 'discord_datastore.channel_message_total' }}
                </button></div>
              {{/each}}
            </div>
          {{else}}
            {{ i18n "discord_datastore.no_channels" }}
          {{/if}}  

        {{else}}
          <div class='spinner'></div> 
        {{/if}}     
      </div>

      <div class="discord-data-messages">
          <div class ="discord-data-messages-header">
            
            <h3>{{d-icon 'fab-discord'}}{{" "}}{{ i18n "discord_datastore.message_history_title" }}</h3>
            <div class="message-paginate-buttons">
              <button {{ action "prevMessagePage" }} type='submit' class='discord-button'>
                {{ i18n "discord_datastore.message_pagination_previous" }}
              </button>
              <b>{{ current_page }}</b>
              <button {{ action "nextMessagePage" }} type='submit' class='discord-button' >
                {{ i18n "discord_datastore.message_pagination_next" }}
              </button>
            </div>

          </div>

        {{#if messages_loaded}}

          {{#if messages}}

            <div class="discord-message-list" >
              <ul>
                {{#each messages as |message|}}
                  <li>
                    <div class="discord-message">
                      <div class="discord-avatar"><img src="{{message.user_avatar}}" alt="" /></div>
                      <div class="discord-message-content">
                        {{ message.user_nickname }}{{ " in " }}<b>{{"#"}}{{ message.channel_name }}</b>{{ " on " }}{{ message.date }}{{":"}}<br>
                        {{#if message.attachments}}
                          <div class="discord-attachments">{{"attachments: " }}
                          {{#each message.attachments as |attachment|}}
                            <a class="discord-attachment" href={{attachment}}>ðŸ“Ž</a>
                          {{/each}}
                          </div>
                        {{/if}}
                        {{ message.content }}
                      </div>
                    </div>
                  </li>
                {{/each}}
              </ul>
            </div>
          {{else}}
            <div class="no-messages">{{ i18n "discord_datastore.no_messages" }}</div>
          {{/if}}

        {{else}}
          <div class='spinner'></div> 
        {{/if}}  

      </div>

    </div>
  </div>

{{else}}

  {{#if id_loaded}}

    <div class="discord-join-info">
      {{ i18n "discord_datastore.warning_no_account_found" }}
      <br><br>
      {{#if siteSettings.discord_invite_url }}
        <h2>{{'1. '}}<a href={{siteSettings.discord_invite_url}}>{{i18n 'discord_datastore.join_discord_message' }}</a></h2>
      {{else}}
        <h2>{{'1. '}}{{i18n 'discord_datastore.join_discord_message' }}</h2>
      {{/if}}
      <h2>{{'2. '}}<a href={{'/my/preferences/account'}}>{{i18n 'discord_datastore.connect_discord_message' }}</a></h2>
    </div>

  {{/if}}

{{/if}}
